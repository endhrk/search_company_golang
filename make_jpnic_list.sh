#!/bin/bash

curl -s https://www.nic.ad.jp/ja/dns/jp-addr-block.html | xmllint --html --xpath "//table/tr" - 2>/dev/null | grep -v "ï½ž" | xmllint --html --xpath "//tr/td" - | sed -e "s/<\/td><td>/\n/g" -e "s/^<td>//" -e "s/<\/td>$//" | awk 'BEGIN{start=""; end="";} {if((NR%2)==1){start=$1}else{end=$1}; if((NR%2)==0){cmd = "/usr/share/doc/libnet-ip-perl/examples/ipcount " start " - " end " | sed -e \"s/^ *[^ /]*\\(\\/[0-9]*\\).*/\\1/g\""; cmd | getline subnet; close(cmd); print start subnet}}'
curl -s https://www.nic.ad.jp/ja/dns/ap-addr-block.html | xmllint --html --xpath "//table/tr" - 2>/dev/null | grep -v style | xmllint --html --xpath "//tr/td" - | sed -e "s/<\/td><td>/\n/g" -e "s/^<td>//" -e "s/<\/td>$//" | awk 'BEGIN{start=""; end="";} {if((NR%2)==1){start=$1}else{end=$1}; if((NR%2)==0){cmd = "/usr/share/doc/libnet-ip-perl/examples/ipcount " start " - " end " | sed -e \"s/^ *[^ /]*\\(\\/[0-9]*\\).*/\\1/g\""; cmd | getline subnet; close(cmd); print start subnet}}'
